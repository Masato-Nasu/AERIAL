<!doctype html><meta charset="utf-8">
<title>AERIAL v10.1 — Theremin</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<p>V101 / ▶ を押して開始。傾き/マウスでピッチ、振るとチャイム。</p>
<button id="unlock">▶ 音を有効化</button>
<button id="beep">Beep</button>
<script>
let ctx, osc, g, chime;
function map(x,a,b,c,d){return (x-a)*(d-c)/(b-a)+c;}
async function boot(){
  if (ctx) return;
  const C = window.AudioContext || window.webkitAudioContext;
  ctx = new C({latencyHint:'interactive'});
  g = ctx.createGain(); g.gain.value = .08; g.connect(ctx.destination);
  osc = ctx.createOscillator(); osc.type='sine'; osc.frequency.value=440; osc.connect(g); osc.start();
  try { const ab = await (await fetch('../Chime.mp3',{cache:'no-store'})).arrayBuffer(); chime = await ctx.decodeAudioData(ab); } catch {}
  addEventListener('pointermove', ev=>{
    if(!ctx) return;
    const f = map(ev.clientX, 0, innerWidth, 180, 1200);
    osc.frequency.setTargetAtTime(f, ctx.currentTime, .03);
  }, {passive:true});
  addEventListener('devicemotion', ev=>{
    const a = ev.accelerationIncludingGravity||{};
    const mag = Math.hypot(a.x||0,a.y||0,a.z||0);
    if (mag>28 && chime) { const s=ctx.createBufferSource(); s.buffer=chime; s.connect(ctx.destination); s.start(); }
  }, {passive:true});
  const o=ctx.createOscillator(), gg=ctx.createGain(); gg.gain.value=.15; o.frequency.value=660;
  o.connect(gg).connect(ctx.destination); o.start(); o.stop(ctx.currentTime+.08);
}
document.getElementById('unlock').onclick = async ()=>{ await boot(); await ctx.resume(); };
document.getElementById('beep').onclick = ()=>{ if(!ctx) return; const o=ctx.createOscillator(), gg=ctx.createGain(); gg.gain.value=.2; o.frequency.value=550; o.connect(gg).connect(ctx.destination); o.start(); o.stop(ctx.currentTime+.25); };
</script>
