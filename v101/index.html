<!doctype html><meta charset="utf-8">
<title>AERIAL v10.1 — PWA</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="manifest" href="./manifest.json?v=101">
<a href="./hum-theremin-recorder.html?v=101">▶ テルミンを開く</a>
<button id="btnUpdate" hidden>更新を適用</button>
<button id="btnReset">キャッシュ/SW クリア</button>
<script>
if ('serviceWorker' in navigator) {
  addEventListener('load', async () => {
    const reg = await navigator.serviceWorker.register('./sw.js?b='+Date.now(), {scope:'./', updateViaCache:'none'});
    const show = () => document.getElementById('btnUpdate').hidden = !reg.waiting;
    reg.addEventListener('updatefound', () => reg.installing?.addEventListener('statechange', show));
    navigator.serviceWorker.addEventListener('controllerchange', () => location.reload());
    show();
    document.getElementById('btnUpdate').onclick = () => reg.waiting?.postMessage('SKIP_WAITING');
  });
}
document.getElementById('btnReset').onclick = async () => {
  for (const r of await navigator.serviceWorker.getRegistrations()) await r.unregister();
  for (const k of await caches.keys()) await caches.delete(k);
  location.reload();
};
</script>
