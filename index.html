<!doctype html>
<html lang="ja"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>AERIAL — v8.2 HumTaste × Theremin + Recorder</title>
<meta name="theme-color" content="#0b0d11"/>
<link rel="manifest" href="manifest.json?v=8.2c"/>
<link rel="icon" href="icon-192.png" sizes="192x192"/>
<style>
  body{margin:0;background:linear-gradient(180deg,#0b0d11,#10121a);color:#e6e6e6;font-family:system-ui,'Noto Sans JP',sans-serif}
  .center{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:24px}
  h1{font-weight:300;letter-spacing:3px}
  .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:10px}
  a.btn{padding:10px 16px;background:#0f1320;border:1px solid #253043;border-radius:10px;color:#cfe7ff;text-decoration:none}
  .muted{opacity:.7;font-size:12px;margin-top:8px}
</style>
</head><body>
<div class="center">
  <img src="icon-192.png" width="96" height="96" alt="logo" style="opacity:.9;filter:drop-shadow(0 0 12px #8fd3ff50)">
  <h1>AERIAL</h1>
  <p>v8.2 — HumTaste × Theremin（内蔵アンプ優先）＋ WAV レコーダー</p>
  <div class="row">
    <a class="btn" href="hum-theremin-recorder.html?v=8.2c">▶ Launch</a>
  </div>
  <div class="muted">Dark Minimal / antenna icon · chime burst · yaw/pitch/roll smoothing</div>
</div>

<script>
window.APP_VERSION = (window.APP_VERSION||'8.2c');
(async function hardResetIfNeeded() {
  try {
    // Persist current version in localStorage; if differs, nuke SW + caches
    const k = 'AERIAL_APP_VERSION';
    const prev = localStorage.getItem(k);
    if (prev !== APP_VERSION) {
      if ('serviceWorker' in navigator) {
        const regs = await navigator.serviceWorker.getRegistrations();
        for (const r of regs) { try { await r.unregister(); } catch{} }
      }
      if ('caches' in self) {
        const keys = await caches.keys();
        await Promise.all(keys.map(k => caches.delete(k)));
      }
      localStorage.setItem(k, APP_VERSION);
      // Add a tiny delay then reload once to pick up new SW
      setTimeout(() => location.reload(), 150);
    }
  } catch(e) { /* ignore */ }
})();
if ('serviceWorker' in navigator) {
  window.addEventListener('load', async () => {
    try {
      const reg = await navigator.serviceWorker.register('./sw.js?v=' + APP_VERSION + '&t=' + Date.now());
      if (reg && reg.waiting) { reg.waiting.postMessage({type:'SKIP_WAITING'}); }
      navigator.serviceWorker.addEventListener('controllerchange', () => { /* new SW active */ });
    } catch(e) { /* ignore */ }
  });
}
</script>


<script>
window.APP_VERSION = (window.APP_VERSION||'8.2c');
(async function hardResetIfNeeded() {
  try {
    // Persist current version in localStorage; if differs, nuke SW + caches
    const k = 'AERIAL_APP_VERSION';
    const prev = localStorage.getItem(k);
    if (prev !== APP_VERSION) {
      if ('serviceWorker' in navigator) {
        const regs = await navigator.serviceWorker.getRegistrations();
        for (const r of regs) { try { await r.unregister(); } catch{} }
      }
      if ('caches' in self) {
        const keys = await caches.keys();
        await Promise.all(keys.map(k => caches.delete(k)));
      }
      localStorage.setItem(k, APP_VERSION);
      // Add a tiny delay then reload once to pick up new SW
      setTimeout(() => location.reload(), 150);
    }
  } catch(e) { /* ignore */ }
})();
if ('serviceWorker' in navigator) {
  window.addEventListener('load', async () => {
    try {
      const reg = await navigator.serviceWorker.register('./sw.js?v=' + APP_VERSION + '&t=' + Date.now());
      if (reg && reg.waiting) { reg.waiting.postMessage({type:'SKIP_WAITING'}); }
      navigator.serviceWorker.addEventListener('controllerchange', () => { /* new SW active */ });
    } catch(e) { /* ignore */ }
  });
}
</script>

</body></html>
